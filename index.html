<!DOCTYPE html>
<html>
<head>
  <title>3D Kart Prototype</title>
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>
<body>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5, 10, 7);
scene.add(light);

// Ground
const groundGeometry = new THREE.PlaneGeometry(100, 100);
const groundMaterial = new THREE.MeshStandardMaterial({ color: 0x228b22 });
const ground = new THREE.Mesh(groundGeometry, groundMaterial);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// Kart
const kartGeometry = new THREE.BoxGeometry(1, 0.5, 2);
const kartMaterial = new THREE.MeshStandardMaterial({ color: 0xff0000 });
const kart = new THREE.Mesh(kartGeometry, kartMaterial);
kart.position.y = 0.25;
scene.add(kart);

// Movement variables
let velocity = new THREE.Vector3();
let speed = 0;
const maxSpeed = 0.2;
const acceleration = 0.01;
const friction = 0.005;

const keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

function updateMovement() {

  if (keys["ArrowUp"]) {
    speed += acceleration;
  }

  if (keys["ArrowDown"]) {
    speed -= acceleration;
  }

  speed = Math.max(-maxSpeed / 2, Math.min(maxSpeed, speed));

  if (!keys["ArrowUp"] && !keys["ArrowDown"]) {
    if (speed > 0) speed -= friction;
    if (speed < 0) speed += friction;
    if (Math.abs(speed) < 0.001) speed = 0;
  }

  if (speed !== 0) {
    if (keys["ArrowLeft"]) kart.rotation.y += 0.03;
    if (keys["ArrowRight"]) kart.rotation.y -= 0.03;
  }

  const forward = new THREE.Vector3(0, 0, -1);
  forward.applyQuaternion(kart.quaternion);
  velocity.copy(forward).multiplyScalar(speed);

  kart.position.add(velocity);
}

function updateCamera() {
  const offset = new THREE.Vector3(0, 3, 6);
  offset.applyQuaternion(kart.quaternion);

  camera.position.copy(kart.position).add(offset);
  camera.lookAt(kart.position);
}

function animate() {
  requestAnimationFrame(animate);

  updateMovement();
  updateCamera();

  renderer.render(scene, camera);
}

animate();
</script>

</body>
</html>
